@page "/bearing"
@using CottageFinder.Interfaces
@using CottageFinder.Models
@inject IBearingService BearingService

<h3>Bearing Calculator</h3>

<div class="bearing-container">
    <div class="input-section">
        <h4>Target Coordinates</h4>
        <div class="form-group">
            <label>Latitude:</label>
            <input type="number" step="any" @bind="targetLatitude" placeholder="e.g., 40.7128" />
        </div>
        <div class="form-group">
            <label>Longitude:</label>
            <input type="number" step="any" @bind="targetLongitude" placeholder="e.g., -74.0060" />
        </div>
        <button class="btn btn-primary" @onclick="CalculateBearing">Calculate Bearing</button>
    </div>

    @if (bearingResult != null)
    {
        <div class="result-section">
            <h4>Bearing Result</h4>
            <div class="result-details">
                <div class="result-item">
                    <strong>Bearing:</strong> @bearingResult.BearingDegrees.ToString("F1")°
                </div>
                <div class="result-item">
                    <strong>Direction:</strong> @bearingResult.CompassDirection
                </div>
                <div class="result-item">
                    <strong>Distance:</strong> @bearingResult.DistanceKilometers.ToString("F2") km
                </div>
                <div class="result-item">
                    <strong>From:</strong> @bearingResult.FromLocation.Latitude.ToString("F4")°, @bearingResult.FromLocation.Longitude.ToString("F4")°
                </div>
                <div class="result-item">
                    <strong>To:</strong> @bearingResult.ToLocation.Latitude.ToString("F4")°, @bearingResult.ToLocation.Longitude.ToString("F4")°
                </div>
                <div class="result-item">
                    <strong>Calculated:</strong> @bearingResult.CalculatedAt.ToString("HH:mm:ss")
                </div>
            </div>
        </div>
    }

    @if (!string.IsNullOrEmpty(errorMessage))
    {
        <div class="error-section">
            <p class="error">@errorMessage</p>
        </div>
    }
</div>

@code {
    private double targetLatitude = 40.7128; // Example: New York City
    private double targetLongitude = -74.0060;
    private BearingResult? bearingResult;
    private string errorMessage = string.Empty;

    private async Task CalculateBearing()
    {
        errorMessage = string.Empty;
        bearingResult = null;

        try
        {
            bearingResult = await BearingService.CalculateBearingToTargetAsync(targetLatitude, targetLongitude);
            
            if (bearingResult == null)
            {
                errorMessage = "Could not get current location. Please ensure location permissions are granted.";
            }
        }
        catch (Exception ex)
        {
            errorMessage = $"Error calculating bearing: {ex.Message}";
        }
    }
}